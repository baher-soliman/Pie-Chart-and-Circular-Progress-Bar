function round(e, t) { return Number(Math.round(e + "e" + t) + "e-" + t) } $.fn.pieChart = function (e) { if (e == null || e == undefined) e = {}; if (e.radius == undefined || e.radius == null) e.radius = 50; if (e.borderWidth == undefined || e.borderWidth == null) e.borderWidth = 10; if (e.data == undefined || e.data == null) e.data = []; var t = 0; for (var n = 0; n < e.data.length; n++) { if (e.data[n] == undefined || e.data[n] == null) e.data[n] = {}; if (e.data[n].title == undefined || e.data[n].title == null) e.data[n].title = "item" + (n + 1).toString(); if (e.data[n].measure == undefined || e.data[n].measure == null) e.data[n].measure = 0; if (e.data[n].borderColor == undefined || e.data[n].borderColor == null) e.data[n].borderColor = "#eee"; if (e.data[n].fillColor == undefined || e.data[n].fillColor == null) e.data[n].fillColor = "Transparent"; if (e.data[n].measure < 0) { alert("Invalid measure in data item index: " + n); return } t += e.data[n].measure } if (t == 0) { alert("Sum of all measures cannot be zero"); return } this.css("position", "relative").css("height", (e.radius + e.borderWidth) * 2 + "px").css("width", (e.radius + e.borderWidth) * 2 + "px"); var r = e.data.length + 1; this.append("<div class='leftHalf' style='width:" + (e.radius + e.borderWidth) + "px;height:" + (e.radius + e.borderWidth) * 2 + "px;'></div>"); this.append("<div class='rightHalf' style='width:" + (e.radius + e.borderWidth) + "px;height:" + (e.radius + e.borderWidth) * 2 + "px;left:" + (e.radius + e.borderWidth) + "px;'></div>"); this.after("<div class='appendix' style='width:" + (e.radius + e.borderWidth) * 2 + "px;'></div>"); for (var n = 0; n < e.data.length; n++) { e.data[n].percentage = e.data[n].measure / t * 100 } var i = 0; for (var n = 0; n < e.data.length; n++) { r--; tempPercentageIndexer = i; i += e.data[n].percentage; var s = 360 * i / 100; var o = round(e.data[n].percentage, 2); var u = e.data[n].tooltip; if (u == undefined) u = e.data[n].title + " (" + o + "%)"; if (e.data[n].percentage > 50) { this.find(".rightHalf").append("<div title='" + u + "' class='movingHalf' style='left:-" + (e.radius + e.borderWidth) + "px;-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg);width:" + e.radius + "px;height:" + e.radius * 2 + "px;border-top-left-radius:" + (e.radius + e.borderWidth).toString() + "px;border-bottom-left-radius:" + (e.radius + e.borderWidth).toString() + "px;z-index:" + r + ";background-color:" + e.data[n].fillColor + ";border-color:" + e.data[n].borderColor + ";border-width:" + e.borderWidth + "px;'></div>") } if (tempPercentageIndexer < 50) this.find(".rightHalf").append("<div title='" + u + "' class='movingHalf' style='left:-" + (e.radius + e.borderWidth) + "px;-webkit-transform:rotate(" + s + "deg);-moz-transform:rotate(" + s + "deg);-ms-transform:rotate(" + s + "deg);transform:rotate(" + s + "deg);width:" + e.radius + "px;height:" + e.radius * 2 + "px;border-top-left-radius:" + (e.radius + e.borderWidth).toString() + "px;border-bottom-left-radius:" + (e.radius + e.borderWidth).toString() + "px;z-index:" + r + ";background-color:" + e.data[n].fillColor + ";border-color:" + e.data[n].borderColor + ";border-width:" + e.borderWidth + "px;'></div>"); if (i > 50) this.find(".leftHalf").append("<div title='" + u + "' class='movingHalf' style='-webkit-transform:rotate(" + s + "deg);-moz-transform:rotate(" + s + "deg);-ms-transform:rotate(" + s + "deg);transform:rotate(" + s + "deg);width:" + e.radius + "px;height:" + e.radius * 2 + "px;border-top-left-radius:" + (e.radius + e.borderWidth).toString() + "px;border-bottom-left-radius:" + (e.radius + e.borderWidth).toString() + "px;z-index:" + r + ";background-color:" + e.data[n].fillColor + ";border-color:" + e.data[n].borderColor + ";border-width:" + e.borderWidth + "px;'></div>"); this.find("+div.appendix").append("<div class='appItem'><span class='colorBullet' style='background-color:" + e.data[n].borderColor + ";'></span> <span class='appItemText'>" + e.data[n].title + " (" + o + "%)" + "</span></div>") } this.find("+div.appendix").append("<div class='clear'></div>") }